"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[8151],{1696:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var n=a(5893),r=a(1151);a(4866),a(5162);const o={sidebar_position:5,title:"Microsoft Fabric"},i="Querying from Microsoft Fabric",s={id:"fabric",title:"Microsoft Fabric",description:"This guide offers a short tutorial on how to query Apache Iceberg and Apache Hudi tables in Microsoft Fabric utilizing",source:"@site/docs/fabric.md",sourceDirName:".",slug:"/fabric",permalink:"/docs/fabric",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"Microsoft Fabric"},sidebar:"docs",previous:{title:"Google BigQuery",permalink:"/docs/bigquery"},next:{title:"Presto",permalink:"/docs/presto"}},c={},l=[{value:"What is Microsoft Fabric",id:"what-is-microsoft-fabric",level:2},{value:"Tutorial",id:"tutorial",level:2},{value:"Pre-requisites",id:"pre-requisites",level:3},{value:"Step 1. Create a source table in ADLS",id:"step-1-create-a-source-table-in-adls",level:3},{value:"Step 2. Translate source table to Delta Lake format using Apache XTable\u2122 (Incubating)\u2122",id:"step-2-translate-source-table-to-delta-lake-format-using-apache-xtable-incubating",level:3},{value:"Step 3. Create a Shortcut in Fabric and Analyze",id:"step-3-create-a-shortcut-in-fabric-and-analyze",level:3}];function u(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",sup:"sup",ul:"ul",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"querying-from-microsoft-fabric",children:"Querying from Microsoft Fabric"}),"\n",(0,n.jsxs)(t.p,{children:["This guide offers a short tutorial on how to query Apache Iceberg and Apache Hudi tables in Microsoft Fabric utilizing\nthe translation capabilities of Apache XTable\u2122 (Incubating). This tutorial is intended solely for demonstration and to verify the\ncompatibility of Apache XTable\u2122 (Incubating) output with Fabric. The tutorial leverages the currently",(0,n.jsx)(t.sup,{children:(0,n.jsx)(t.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})," available features in Fabric, like\n",(0,n.jsx)(t.code,{children:"Shortcuts"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"what-is-microsoft-fabric",children:"What is Microsoft Fabric"}),"\n",(0,n.jsx)(t.p,{children:"Microsoft Fabric is a unified data analytics platform for data analytics. It offers a wide range of capabilities\nincluding data engineering, data science, real-time analytics, and business intelligence. At its core is the data\nlake, OneLake, which provides tabular data stored in Delta Parquet format, allowing one copy of the data to be used in\nall Fabric analytical services like T-SQL,\nSpark, and Power BI. OneLake is designed to do away with the need for data duplication and eliminates the necessity\nfor data migration or transfers. Whether it's a data engineer adding data to a table using Spark or a SQL developer\nanalyzing data with T-SQL in a data warehouse, both can access and work on the same data copy stored in OneLake.\nAdditionally, OneLake enables integration of existing storage accounts via its 'Shortcut' feature, which acts as a link\nto data in other file systems."}),"\n",(0,n.jsx)(t.h2,{id:"tutorial",children:"Tutorial"}),"\n",(0,n.jsx)(t.p,{children:"The objective of the following tutorial is to translate an Iceberg or Hudi table in ADLS storage account into Delta Lake\nformat using Apache XTable\u2122 (Incubating). After translation, this table will be accessible for querying from various Fabric engines,\nincluding T-SQL, Spark, and Power BI."}),"\n",(0,n.jsx)(t.h3,{id:"pre-requisites",children:"Pre-requisites"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["An active ",(0,n.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/fabric/get-started/workspaces",children:"Microsoft Fabric Workspace"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["A storage account with a container in ",(0,n.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/azure/storage/blobs/data-lake-storage-introduction",children:"Azure Data Lake Storage Gen2"})," (ADLS)."]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"step-1-create-a-source-table-in-adls",children:"Step 1. Create a source table in ADLS"}),"\n",(0,n.jsxs)(t.p,{children:["This step creates a source table in Iceberg or Hudi format in the ADLS storage account. The primary actions to be\ntaken to create a table ",(0,n.jsx)(t.code,{children:"people"})," in Iceberg or Hudi format are documented in\n",(0,n.jsx)(t.a,{href:"/docs/how-to#create-dataset",children:"Creating your first interoperable table - Create Dataset"})," tutorial section. However, instead of creating the\n",(0,n.jsx)(t.code,{children:"people"})," table locally, configure ",(0,n.jsx)(t.code,{children:"local_base_path"})," to point to the ADLS storage account."]}),"\n",(0,n.jsxs)(t.p,{children:["Assuming the container name is ",(0,n.jsx)(t.code,{children:"mycontainer"})," and the storage account name is ",(0,n.jsx)(t.code,{children:"mystorageaccount"}),", the ",(0,n.jsx)(t.code,{children:"local_base_path"}),"\nshould be set to ",(0,n.jsx)(t.code,{children:"abfs://mycontainer@mystorageaccount.dfs.core.windows.net/"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"An example spark configuration for authenticating to ADLS storage account is as follows:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"spark.hadoop.fs.azure.account.auth.type=OAuth\nspark.hadoop.fs.azure.account.oauth.provider.type=org.apache.hadoop.fs.azurebfs.oauth2.ClientCredsTokenProvider\nspark.hadoop.fs.azure.account.oauth2.client.endpoint=https://login.microsoftonline.com/<tenant-id>/oauth2/token\nspark.hadoop.fs.azure.account.oauth2.client.id=<client-id>\nspark.hadoop.fs.azure.account.oauth2.client.secret=<client-secret>\n"})}),"\n",(0,n.jsx)(t.h3,{id:"step-2-translate-source-table-to-delta-lake-format-using-apache-xtable-incubating",children:"Step 2. Translate source table to Delta Lake format using Apache XTable\u2122 (Incubating)\u2122"}),"\n",(0,n.jsxs)(t.p,{children:["This step translates the table ",(0,n.jsx)(t.code,{children:"people"})," originally in Iceberg or Hudi format to Delta Lake format using Apache XTable\u2122 (Incubating).\nThe primary actions for the translation are documented in\n",(0,n.jsx)(t.a,{href:"/docs/how-to#running-sync",children:"Creating your first interoperable table - Running Sync"})," tutorial section.\nHowever, since the table is in ADLS, you need to update datasets path and hadoop configurations."]}),"\n",(0,n.jsx)(t.p,{children:"For e.g. if the source table is in Iceberg format, the configuration file should look like:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",metastring:'md title="my_config.yaml"',children:"sourceFormat: ICEBERG\ntargetFormats:\n  - DELTA\ndatasets:\n  -\n    tableBasePath: abfs://mycontainer@mystorageaccount.dfs.core.windows.net/default/people\n    tableDataPath: abfs://mycontainer@mystorageaccount.dfs.core.windows.net/default/people/data\n    tableName: people\n    # In the configuration above `default` refers to the default spark database.\n"})}),"\n",(0,n.jsx)(t.p,{children:"An example hadoop configuration for authenticating to ADLS storage account is as follows:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-xml",metastring:'md title="hadoop.xml"',children:"<configuration>\n  <property>\n    <name>fs.azure.account.auth.type</name>\n    <value>OAuth</value>\n  </property>\n  <property>\n    <name>fs.azure.account.oauth.provider.type</name>\n    <value>org.apache.hadoop.fs.azurebfs.oauth2.ClientCredsTokenProvider</value>\n  </property>\n  <property>\n    <name>fs.azure.account.oauth2.client.endpoint</name>\n    <value>https://login.microsoftonline.com/[tenant-id]/oauth2/token</value>\n  </property>\n  <property>\n    <name>fs.azure.account.oauth2.client.id</name>\n    <value>[client-id]</value>\n  </property>\n  <property>\n    <name>fs.azure.account.oauth2.client.secret</name>\n    <value>[client-secret]</value>\n  </property>\n</configuration>\n"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",metastring:'md title="shell"',children:"java -jar utilities/target/utilities-0.1.0-SNAPSHOT-bundled.jar --datasetConfig my_config.yaml --hadoopConfig hadoop.xml\n"})}),"\n",(0,n.jsxs)(t.p,{children:["Running the above command will translate the table ",(0,n.jsx)(t.code,{children:"people"})," in Iceberg or Hudi format to Delta Lake format. To validate\nthe translation, you can list the directories in the table's data path. For this tutorial, ",(0,n.jsx)(t.code,{children:"_delta_log"})," directory\nshould be present in the ",(0,n.jsx)(t.code,{children:"people"})," table's data path at  ",(0,n.jsx)(t.code,{children:"default/people/data/_delta_log"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"step-3-create-a-shortcut-in-fabric-and-analyze",children:"Step 3. Create a Shortcut in Fabric and Analyze"}),"\n",(0,n.jsx)(t.p,{children:"This step creates a shortcut in Fabric to the Delta Lake table created in the previous step. The shortcut is a link to\nthe table's data path in ADLS storage account."}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{children:["Navigate to your Fabric Lakehouse and click on the ",(0,n.jsx)(t.code,{children:"Tables"})," and select ",(0,n.jsx)(t.code,{children:"New Shortcut"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Invoke new shortcut",src:a(953).Z+"",width:"386",height:"196"})}),"\n"]}),"\n",(0,n.jsxs)(t.ol,{start:"2",children:["\n",(0,n.jsxs)(t.li,{children:["In the ",(0,n.jsx)(t.code,{children:"New Shortcut"})," dialog, select ",(0,n.jsx)(t.code,{children:"Azure Delta Lake Storaget Gen2"})," as the ",(0,n.jsx)(t.code,{children:"External Source"})]}),"\n"]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Select external source",src:a(2175).Z+"",width:"322",height:"344"})}),"\n"]}),"\n",(0,n.jsxs)(t.ol,{start:"4",children:["\n",(0,n.jsxs)(t.li,{children:["In the ",(0,n.jsx)(t.code,{children:"New Shortcut"})," dialog, enter the ",(0,n.jsx)(t.code,{children:"Connection settings"})," and authorize Fabric to access the storage account."]}),"\n"]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Enter connection settings",src:a(3472).Z+"",width:"372",height:"345"})}),"\n"]}),"\n",(0,n.jsxs)(t.ol,{start:"4",children:["\n",(0,n.jsxs)(t.li,{children:["In the ",(0,n.jsx)(t.code,{children:"New Shortcut"})," dialog, enter the ",(0,n.jsx)(t.code,{children:"Shortcut settings"})," and click ",(0,n.jsx)(t.code,{children:"Create"}),"."]}),"\n"]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Enter shortcut settings",src:a(8692).Z+"",width:"251",height:"278"})}),"\n"]}),"\n",(0,n.jsxs)(t.ol,{start:"5",children:["\n",(0,n.jsx)(t.li,{children:"The shortcut is now created and the table is available for querying from Fabric."}),"\n"]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Shortcut created",src:a(4165).Z+"",width:"383",height:"173"})}),"\n"]}),"\n",(0,n.jsxs)(t.section,{"data-footnotes":!0,className:"footnotes",children:[(0,n.jsx)(t.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,n.jsxs)(t.ol,{children:["\n",(0,n.jsxs)(t.li,{id:"user-content-fn-1",children:["\n",(0,n.jsxs)(t.p,{children:["Updated on 2023-11-16 ",(0,n.jsx)(t.a,{href:"#user-content-fnref-1","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},5162:(e,t,a)=>{a.d(t,{Z:()=>i});a(7294);var n=a(6010);const r={tabItem:"tabItem_Ymn6"};var o=a(5893);function i(e){let{children:t,hidden:a,className:i}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,n.Z)(r.tabItem,i),hidden:a,children:t})}},4866:(e,t,a)=>{a.d(t,{Z:()=>k});var n=a(7294),r=a(6010),o=a(2466),i=a(6550),s=a(469),c=a(1980),l=a(7392),u=a(12);function d(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:a}=e;return(0,n.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:r}}=e;return{value:t,label:a,attributes:n,default:r}}))}(a);return function(e){const t=(0,l.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function p(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:a}=e;const r=(0,i.k6)(),o=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,c._X)(o),(0,n.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(r.location.search);t.set(o,e),r.replace({...r.location,search:t.toString()})}),[o,r])]}function b(e){const{defaultValue:t,queryString:a=!1,groupId:r}=e,o=h(e),[i,c]=(0,n.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:o}))),[l,d]=f({queryString:a,groupId:r}),[b,g]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[r,o]=(0,u.Nk)(a);return[r,(0,n.useCallback)((e=>{a&&o.set(e)}),[a,o])]}({groupId:r}),m=(()=>{const e=l??b;return p({value:e,tabValues:o})?e:null})();(0,s.Z)((()=>{m&&c(m)}),[m]);return{selectedValue:i,selectValue:(0,n.useCallback)((e=>{if(!p({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);c(e),d(e),g(e)}),[d,g,o]),tabValues:o}}var g=a(2389);const m={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=a(5893);function j(e){let{className:t,block:a,selectedValue:n,selectValue:i,tabValues:s}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,o.o5)(),u=e=>{const t=e.currentTarget,a=c.indexOf(t),r=s[a].value;r!==n&&(l(t),i(r))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const a=c.indexOf(e.currentTarget)+1;t=c[a]??c[0];break}case"ArrowLeft":{const a=c.indexOf(e.currentTarget)-1;t=c[a]??c[c.length-1];break}}t?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":a},t),children:s.map((e=>{let{value:t,label:a,attributes:o}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:n===t?0:-1,"aria-selected":n===t,ref:e=>c.push(e),onKeyDown:d,onClick:u,...o,className:(0,r.Z)("tabs__item",m.tabItem,o?.className,{"tabs__item--active":n===t}),children:a??t},t)}))})}function y(e){let{lazy:t,children:a,selectedValue:r}=e;const o=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===r));return e?(0,n.cloneElement)(e,{className:"margin-top--md"}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==r})))})}function v(e){const t=b(e);return(0,x.jsxs)("div",{className:(0,r.Z)("tabs-container",m.tabList),children:[(0,x.jsx)(j,{...e,...t}),(0,x.jsx)(y,{...e,...t})]})}function k(e){const t=(0,g.Z)();return(0,x.jsx)(v,{...e,children:d(e.children)},String(t))}},953:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/shortcut_1_1-8e9348e739a023a382d6362d8e1326e1.png"},2175:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/shortcut_1_2-02974276e01e2b4cef3d99dc2f515e0d.png"},3472:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/shortcut_1_3-a66ebfc40dc124ae8004279422a06dc1.png"},8692:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/shortcut_1_4-e49771229edd691bbe3d1f25795584df.png"},4165:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/shortcut_1_5-eae8c4280fe7a5024c0f58c1a54575f5.png"},1151:(e,t,a)=>{a.d(t,{Z:()=>s,a:()=>i});var n=a(7294);const r={},o=n.createContext(r);function i(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);